{"links": {"self": {"href": "data/repositories/hoffmanlab/genomedata/issues/38/comments/36586368.json"}, "html": {"href": "#!/hoffmanlab/genomedata/issues/38#comment-36586368"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/genomedata/issues/38.json"}}, "type": "issue", "id": 38, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/genomedata.json"}, "html": {"href": "#!/hoffmanlab/genomedata"}, "avatar": {"href": "data/bytebucket.org/ravatar/{78038659-1199-46ff-9d0a-675c62f89d60}ts=python"}}, "type": "repository", "name": "genomedata", "full_name": "hoffmanlab/genomedata", "uuid": "{78038659-1199-46ff-9d0a-675c62f89d60}"}, "title": "PyTables >= 3.4.1 causes a core dump when reading a continuous section from a supercontig"}, "content": {"raw": "The following script breaks on opening an hdf5 file with a Pytables table:\n\n```\n#!python\n\n#!/usr/bin/env python\n\n# Opens an hdf5 genomedata file for testing\nfrom tables import open_file\nimport sys\n\nif len(sys.argv[1]) < 3:\n    print(\"Usage: tables_test.py hdf5file hdf5path_to_table\")\n\nhdf5_filename = sys.argv[1]\nhdf5_path_to_table = sys.argv[2]\n\n# Open the h5file\nprint(\"Opening hdf5 file: {}\".format(hdf5_filename))\nh5file = open_file(hdf5_filename)\n\nprint(\"Getting table from hdf5 path: {}\".format(hdf5_path_to_table))\npytable = h5file.get_node(hdf5_path_to_table)\nprint(\"PyTables info: {}\".format(repr(pytable)))\n\nprint(\"Attempting to index into table at 0...\")\nprint pytable[0]\n\n# Close the h5file\nh5file.close()\n```\n\ne.g. in the genomedata test source path:\n\n```\n#!bash\n\n$ python tables_test.py \"data/v1.genomedata\" \"/chr1/supercontig_0/continuous\"\nOpening hdf5 file: data/v1.genomedata\nGetting table from hdf5 path: /chr1/supercontig_0/continuous\nPyTables info: /chr1/supercontig_0/continuous (EArray(24950, 3), shuffle, zlib(1)) ''\n  atom := Float32Atom(shape=(), dflt=0.0)\n  maindim := 1\n  flavor := 'numpy'\n  byteorder := 'little'\n  chunkshape := (10000, 1)\nAttempting to index into table at 0...\nIllegal instruction (core dumped)\n```\n\nThis error could not be reproduced using the example hdf5 file [h5ex_t_array.h5](https://support.hdfgroup.org/ftp/HDF5/examples/files/exbyapi/h5ex_t_array.h5) from the HDF Group:\n\n```\n#!bash\n\n$ python tables_test.py h5ex_t_float.h5 \"/DS1\"\nOpening hdf5 file: h5ex_t_float.h5\nGetting table from hdf5 path: /DS1\nPyTables info: /DS1 (Array(4, 7)) ''\n  atom := Float64Atom(shape=(), dflt=0.0)\n  maindim := 0\n  flavor := 'numpy'\n  byteorder := 'little'\n  chunkshape := None\nAttempting to index into table at 0...\n[ 0.  1.  2.  3.  4.  5.  6.]\n```", "markup": "markdown", "html": "<p>The following script breaks on opening an hdf5 file with a Pytables table:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"ch\">#!/usr/bin/env python</span>\n\n<span class=\"c1\"># Opens an hdf5 genomedata file for testing</span>\n<span class=\"kn\">from</span> <span class=\"nn\">tables</span> <span class=\"kn\">import</span> <span class=\"n\">open_file</span>\n<span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n\n<span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])</span> <span class=\"o\">&lt;</span> <span class=\"mi\">3</span><span class=\"p\">:</span>\n    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Usage: tables_test.py hdf5file hdf5path_to_table&quot;</span><span class=\"p\">)</span>\n\n<span class=\"n\">hdf5_filename</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n<span class=\"n\">hdf5_path_to_table</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span>\n\n<span class=\"c1\"># Open the h5file</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Opening hdf5 file: {}&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">hdf5_filename</span><span class=\"p\">))</span>\n<span class=\"n\">h5file</span> <span class=\"o\">=</span> <span class=\"n\">open_file</span><span class=\"p\">(</span><span class=\"n\">hdf5_filename</span><span class=\"p\">)</span>\n\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Getting table from hdf5 path: {}&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">hdf5_path_to_table</span><span class=\"p\">))</span>\n<span class=\"n\">pytable</span> <span class=\"o\">=</span> <span class=\"n\">h5file</span><span class=\"o\">.</span><span class=\"n\">get_node</span><span class=\"p\">(</span><span class=\"n\">hdf5_path_to_table</span><span class=\"p\">)</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;PyTables info: {}&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"nb\">repr</span><span class=\"p\">(</span><span class=\"n\">pytable</span><span class=\"p\">)))</span>\n\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Attempting to index into table at 0...&quot;</span><span class=\"p\">)</span>\n<span class=\"k\">print</span> <span class=\"n\">pytable</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n<span class=\"c1\"># Close the h5file</span>\n<span class=\"n\">h5file</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"p\">()</span>\n</pre></div>\n\n\n<p>e.g. in the genomedata test source path:</p>\n<div class=\"codehilite language-bash\"><pre><span></span>$ python tables_test.py <span class=\"s2\">&quot;data/v1.genomedata&quot;</span> <span class=\"s2\">&quot;/chr1/supercontig_0/continuous&quot;</span>\nOpening hdf5 file: data/v1.genomedata\nGetting table from hdf5 path: /chr1/supercontig_0/continuous\nPyTables info: /chr1/supercontig_0/continuous <span class=\"o\">(</span>EArray<span class=\"o\">(</span><span class=\"m\">24950</span>, <span class=\"m\">3</span><span class=\"o\">)</span>, shuffle, zlib<span class=\"o\">(</span><span class=\"m\">1</span><span class=\"o\">))</span> <span class=\"s1\">&#39;&#39;</span>\n  atom :<span class=\"o\">=</span> Float32Atom<span class=\"o\">(</span><span class=\"nv\">shape</span><span class=\"o\">=()</span>, <span class=\"nv\">dflt</span><span class=\"o\">=</span><span class=\"m\">0</span>.0<span class=\"o\">)</span>\n  maindim :<span class=\"o\">=</span> <span class=\"m\">1</span>\n  flavor :<span class=\"o\">=</span> <span class=\"s1\">&#39;numpy&#39;</span>\n  byteorder :<span class=\"o\">=</span> <span class=\"s1\">&#39;little&#39;</span>\n  chunkshape :<span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"m\">10000</span>, <span class=\"m\">1</span><span class=\"o\">)</span>\nAttempting to index into table at <span class=\"m\">0</span>...\nIllegal instruction <span class=\"o\">(</span>core dumped<span class=\"o\">)</span>\n</pre></div>\n\n\n<p>This error could not be reproduced using the example hdf5 file <a data-is-external-link=\"true\" href=\"https://support.hdfgroup.org/ftp/HDF5/examples/files/exbyapi/h5ex_t_array.h5\" rel=\"nofollow\">h5ex_t_array.h5</a> from the HDF Group:</p>\n<div class=\"codehilite language-bash\"><pre><span></span>$ python tables_test.py h5ex_t_float.h5 <span class=\"s2\">&quot;/DS1&quot;</span>\nOpening hdf5 file: h5ex_t_float.h5\nGetting table from hdf5 path: /DS1\nPyTables info: /DS1 <span class=\"o\">(</span>Array<span class=\"o\">(</span><span class=\"m\">4</span>, <span class=\"m\">7</span><span class=\"o\">))</span> <span class=\"s1\">&#39;&#39;</span>\n  atom :<span class=\"o\">=</span> Float64Atom<span class=\"o\">(</span><span class=\"nv\">shape</span><span class=\"o\">=()</span>, <span class=\"nv\">dflt</span><span class=\"o\">=</span><span class=\"m\">0</span>.0<span class=\"o\">)</span>\n  maindim :<span class=\"o\">=</span> <span class=\"m\">0</span>\n  flavor :<span class=\"o\">=</span> <span class=\"s1\">&#39;numpy&#39;</span>\n  byteorder :<span class=\"o\">=</span> <span class=\"s1\">&#39;little&#39;</span>\n  chunkshape :<span class=\"o\">=</span> None\nAttempting to index into table at <span class=\"m\">0</span>...\n<span class=\"o\">[</span> <span class=\"m\">0</span>.  <span class=\"m\">1</span>.  <span class=\"m\">2</span>.  <span class=\"m\">3</span>.  <span class=\"m\">4</span>.  <span class=\"m\">5</span>.  <span class=\"m\">6</span>.<span class=\"o\">]</span>\n</pre></div>", "type": "rendered"}, "created_on": "2017-05-05T13:28:50.140811+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": "2017-05-05T14:19:51.210385+00:00", "type": "issue_comment", "id": 36586368}